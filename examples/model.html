<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="msapplication-tap-highlight" content="no">
  <title>ChocolateChip-UI Model</title>
  <link rel="stylesheet" href="../dist/css/chui-ios.min.css">
  <script src="../dist/chui.min.js"></script>
  <script type="application/json" src="../dist/chui.min.js.map"></script>
<style>
  .themeIsiOS input {
    border: solid 1px #ccc;
  }
  .themeIsAndroid #uniqueAction {
    margin-bottom: 5px;
  }
  .themeIsAndroid #submitForm {
    margin: 5px 0 0;
  }
  #form > li {
    display: flex;
    flex-direction: row !important;
  }
  #peopleAlert + button {
    margin: 10px 0 0 10px;
  }
  #buttonContainer label + label {
    margin-left: 10px;
  }
  #sortList {
    display: inline-block;
  }
  label > input {
    margin-right: 10px;
  }
  [dir=rtl] label > input {
    margin-right: 0;
    margin-left: 10px;
  }
</style>
</head>
<body>
  <screen class="current" id="main">
    <nav class="current">
      <h1>$.Model</h1>
    </nav>
    <section>
      <h2>Add a new person to model</h2>
      <ul class="list" id="form">
        <li>
          <input type="text" id='firstName' placeholder="First Name:">
        </li>
        <li>
          <input type="text" id='lastName' placeholder="Last Name:">
        </li>
        <li>
          <input type="number" id='age' placeholder="Age:">
        </li>
      </ul>
      <p>
        <button id='submitForm'>Submit</button> <label for="peopleAlert">Dispatch to mediator: <input name='peopleAlert' id='peopleAlert' type="checkbox"></label>
        
      </p>
      <h2>Output from Model</h2>
      <p id='buttonContainer'>
        <label>
          <input id='ascending' type="radio" name='sortOrder' value='ascending' checked>Ascending
        </label>
        <label>
          <input id='descending' type="radio" name='sortOrder' value='descending'>Descending
        </label>
        <span>&nbsp; - &nbsp;</span>
        <button id='uniqueAction'>Eliminate Duplicates</button>
      </p>
      <ul id="listView" class='list cloak'>
        <li class='comp'>
          <div>
            <h3>{= data.firstName } {= data.lastName }</h3>
            <h4>Age: {= data.age }</h4>
          </div>
        </li>
      </ul>
      <p>The model has <span id='numberOfPeople'>{= data.count }</span> people.</p>
    </section>
  </screen>
  <script>
  
    /**
     * Plain data object:
     */
    var people = [
      {firstName: "Joe", lastName: "Bodoni", age: 28},
      {firstName: "Sue", lastName: "Higgins", age: 22},
      {firstName: "John", lastName: "Doe", age: 32},
      {firstName: "Betty", lastName: "Bonnet", age: 26},
      {firstName: "Steve", lastName: "Martin", age: 26}
    ];

    /**
     * Define model:
     */
    peopleModel = $.Model(people);
    window.peopleModel = peopleModel;

    var peopleView = $.View({
      element: '#listView', 
      model: peopleModel
    });
    peopleView.render();

    window.peopleView = peopleView;

    $('#numberOfPeople').text(peopleModel.size());

    /**
     * Push something to view model with this flag: 'peopleAlert':
     */
    var peopleMtor = $.on('peopleAlert', function(data) {
      alert('Message from mediator: ' + data.firstName + ' ' + data.lastName);
    });

    /**
     * Submit new person:
     */
    $('#submitForm').on('click', function() {
      var firstName = $('#firstName');
      var lastName = $('#lastName');
      var age = $('#age');
      if (!firstName[0].value || !lastName[0].value || !age[0].value) {
        alert('Please enter a first name, last name and age before submitting.');
        return;
      }
      var person = {};
      person.firstName = $('#firstName').val();
      person.lastName = $('#lastName').val();
      person.age = Number($('#age').val());

      /**
       * Push person to view model.
       */
      if ($('#peopleAlert').prop('checked')) {
        peopleModel.push(person, true);
        $.send('peopleAlert', person);
      } else {
        peopleModel.push(person);
      }

      $('#numberOfPeople').text(peopleModel.size());
    });

    $('#uniqueAction').on('tap', function() {
      peopleModel.unique();
      $('#numberOfPeople').text(peopleModel.size());
    });

    /**
     * Sort list:
     */
    $('#ascending').on('change', function() {
      peopleModel.orderBy('firstName', 'lastName');
    });
    $('#descending').on('change', function() {
      peopleModel.orderBy('-firstName', '-lastName');
    });

  </script>
</body>
</html>